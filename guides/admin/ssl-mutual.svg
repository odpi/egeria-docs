<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1260px" preserveAspectRatio="none" style="width:1358px;height:1260px;" version="1.1" viewBox="0 0 1358 1260" width="1358px" zoomAndPan="magnify"><defs><filter height="300%" id="f8yos2uopizuc" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="828" x="262" y="27.4023">TLS exchange showing client/server access to truststores and keystores (2 way SSL - RFC5246)</text><rect fill="#FFFFFF" filter="url(#f8yos2uopizuc)" height="105.2422" style="stroke: #000000; stroke-width: 2.0;" width="595.5" x="416" y="117.6875"/><rect fill="#FFFFFF" filter="url(#f8yos2uopizuc)" height="843.3848" style="stroke: #000000; stroke-width: 2.0;" width="1326" x="13" y="236.9297"/><rect fill="#FDF5E6" filter="url(#f8yos2uopizuc)" height="203.1738" style="stroke: #000000; stroke-width: 2.0;" width="988.5" x="23" y="545.0352"/><rect fill="#FDF5E6" filter="url(#f8yos2uopizuc)" height="85.9316" style="stroke: #000000; stroke-width: 2.0;" width="711" x="416" y="830.8301"/><rect fill="#FFFFFF" filter="url(#f8yos2uopizuc)" height="75.9316" style="stroke: #000000; stroke-width: 2.0;" width="595.5" x="416" y="1094.3145"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="156" x2="156" y1="100.6875" y2="1187.2461"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="278" x2="278" y1="100.6875" y2="1187.2461"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="455" x2="455" y1="100.6875" y2="1187.2461"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="970.5" x2="970.5" y1="100.6875" y2="1187.2461"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1071.5" x2="1071.5" y1="100.6875" y2="1187.2461"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1205.5" x2="1205.5" y1="100.6875" y2="1187.2461"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100" x="103" y="97.7344">ClientKeyStore</text><path d="M138,48.1992 C138,38.1992 156,38.1992 156,38.1992 C156,38.1992 174,38.1992 174,48.1992 L174,74.1992 C174,84.1992 156,84.1992 156,84.1992 C156,84.1992 138,84.1992 138,74.1992 L138,48.1992 " fill="#90EE90" filter="url(#f8yos2uopizuc)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M138,48.1992 C138,58.1992 156,58.1992 156,58.1992 C156,58.1992 174,58.1992 174,48.1992 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100" x="103" y="1199.7813">ClientKeyStore</text><path d="M138,1212.7344 C138,1202.7344 156,1202.7344 156,1202.7344 C156,1202.7344 174,1202.7344 174,1212.7344 L174,1238.7344 C174,1248.7344 156,1248.7344 156,1248.7344 C156,1248.7344 138,1248.7344 138,1238.7344 L138,1212.7344 " fill="#90EE90" filter="url(#f8yos2uopizuc)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M138,1212.7344 C138,1222.7344 156,1222.7344 156,1222.7344 C156,1222.7344 174,1222.7344 174,1212.7344 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="112" x="219" y="97.7344">ClientTrustStore</text><path d="M260,48.1992 C260,38.1992 278,38.1992 278,38.1992 C278,38.1992 296,38.1992 296,48.1992 L296,74.1992 C296,84.1992 278,84.1992 278,84.1992 C278,84.1992 260,84.1992 260,74.1992 L260,48.1992 " fill="#90EE90" filter="url(#f8yos2uopizuc)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M260,48.1992 C260,58.1992 278,58.1992 278,58.1992 C278,58.1992 296,58.1992 296,48.1992 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="112" x="219" y="1199.7813">ClientTrustStore</text><path d="M260,1212.7344 C260,1202.7344 278,1202.7344 278,1202.7344 C278,1202.7344 296,1202.7344 296,1212.7344 L296,1238.7344 C296,1248.7344 278,1248.7344 278,1248.7344 C278,1248.7344 260,1248.7344 260,1238.7344 L260,1212.7344 " fill="#90EE90" filter="url(#f8yos2uopizuc)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M260,1212.7344 C260,1222.7344 278,1222.7344 278,1222.7344 C278,1222.7344 296,1222.7344 296,1212.7344 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#E6E6FA" filter="url(#f8yos2uopizuc)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="54" x="426" y="65.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="433" y="85.7344">Client</text><rect fill="#E6E6FA" filter="url(#f8yos2uopizuc)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="54" x="426" y="1186.2461"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="433" y="1206.7813">Client</text><rect fill="#E6E6FA" filter="url(#f8yos2uopizuc)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="57" x="940.5" y="65.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="947.5" y="85.7344">Server</text><rect fill="#E6E6FA" filter="url(#f8yos2uopizuc)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="57" x="940.5" y="1186.2461"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="947.5" y="1206.7813">Server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="115" x="1011.5" y="97.7344">ServerTrustStore</text><path d="M1054,48.1992 C1054,38.1992 1072,38.1992 1072,38.1992 C1072,38.1992 1090,38.1992 1090,48.1992 L1090,74.1992 C1090,84.1992 1072,84.1992 1072,84.1992 C1072,84.1992 1054,84.1992 1054,74.1992 L1054,48.1992 " fill="#90EE90" filter="url(#f8yos2uopizuc)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1054,48.1992 C1054,58.1992 1072,58.1992 1072,58.1992 C1072,58.1992 1090,58.1992 1090,48.1992 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="115" x="1011.5" y="1199.7813">ServerTrustStore</text><path d="M1054,1212.7344 C1054,1202.7344 1072,1202.7344 1072,1202.7344 C1072,1202.7344 1090,1202.7344 1090,1212.7344 L1090,1238.7344 C1090,1248.7344 1072,1248.7344 1072,1248.7344 C1072,1248.7344 1054,1248.7344 1054,1238.7344 L1054,1212.7344 " fill="#90EE90" filter="url(#f8yos2uopizuc)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1054,1212.7344 C1054,1222.7344 1072,1222.7344 1072,1222.7344 C1072,1222.7344 1090,1222.7344 1090,1212.7344 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="103" x="1151.5" y="97.7344">ServerKeyStore</text><path d="M1188,48.1992 C1188,38.1992 1206,38.1992 1206,38.1992 C1206,38.1992 1224,38.1992 1224,48.1992 L1224,74.1992 C1224,84.1992 1206,84.1992 1206,84.1992 C1206,84.1992 1188,84.1992 1188,74.1992 L1188,48.1992 " fill="#90EE90" filter="url(#f8yos2uopizuc)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1188,48.1992 C1188,58.1992 1206,58.1992 1206,58.1992 C1206,58.1992 1224,58.1992 1224,48.1992 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="103" x="1151.5" y="1199.7813">ServerKeyStore</text><path d="M1188,1212.7344 C1188,1202.7344 1206,1202.7344 1206,1202.7344 C1206,1202.7344 1224,1202.7344 1224,1212.7344 L1224,1238.7344 C1224,1248.7344 1206,1248.7344 1206,1248.7344 C1206,1248.7344 1188,1248.7344 1188,1238.7344 L1188,1212.7344 " fill="#90EE90" filter="url(#f8yos2uopizuc)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1188,1212.7344 C1188,1222.7344 1206,1222.7344 1206,1222.7344 C1206,1222.7344 1224,1222.7344 1224,1212.7344 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><path d="M416,117.6875 L566,117.6875 L566,124.6875 L556,134.6875 L416,134.6875 L416,117.6875 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="105.2422" style="stroke: #000000; stroke-width: 2.0;" width="595.5" x="416" y="117.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="105" x="431" y="131.2559">TCP handshake</text><polygon fill="#A80036" points="959,152.3086,969,156.3086,959,160.3086,963,156.3086" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="455" x2="965" y1="156.3086" y2="156.3086"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="462" y="151.5664">[1]</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="482" y="151.5664">SYN</text><polygon fill="#A80036" points="466,181.6191,456,185.6191,466,189.6191,462,185.6191" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="460" x2="970" y1="185.6191" y2="185.6191"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="882" y="180.877">[2]</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="902" y="180.877">SYN</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="928" y="180.877">,</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="936" y="180.877">ACK</text><polygon fill="#A80036" points="959,210.9297,969,214.9297,959,218.9297,963,214.9297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="455" x2="965" y1="214.9297" y2="214.9297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="462" y="210.1875">[3]</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="482" y="210.1875">ACK</text><path d="M13,236.9297 L161,236.9297 L161,243.9297 L151,253.9297 L13,253.9297 L13,236.9297 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="843.3848" style="stroke: #000000; stroke-width: 2.0;" width="1326" x="13" y="236.9297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="103" x="28" y="250.498">TLS handshake</text><polygon fill="#A80036" points="959,271.5508,969,275.5508,959,279.5508,963,275.5508" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="455" x2="965" y1="275.5508" y2="275.5508"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="462" y="270.8086">[4]</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="482" y="270.8086">ClientHello</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="395" x="559" y="270.8086">(client-random, TLS version, ciphers, compression,extensions)</text><polygon fill="#A80036" points="1194,300.8613,1204,304.8613,1194,308.8613,1198,304.8613" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="971" x2="1200" y1="304.8613" y2="304.8613"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="978" y="300.1191">[5]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="998" y="300.1191">get my certificate (private key)</text><path d="M1083,317.8613 L1083,342.8613 L1325,342.8613 L1325,327.8613 L1315,317.8613 L1083,317.8613 " fill="#87CEFA" filter="url(#f8yos2uopizuc)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1315,317.8613 L1315,327.8613 L1325,327.8613 L1315,317.8613 " fill="#87CEFA" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="221" x="1089" y="335.4297">Looks for first matching server key</text><polygon fill="#A80036" points="982,369.4824,972,373.4824,982,377.4824,978,373.4824" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="976" x2="1205" y1="373.4824" y2="373.4824"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="990" y="368.7402">[6]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="189" x="1010" y="368.7402">returns certificate (public key)</text><polygon fill="#A80036" points="466,398.793,456,402.793,466,406.793,462,402.793" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="460" x2="970" y1="402.793" y2="402.793"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="668" y="398.0508">[7]</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77" x="688" y="398.0508">ServerHello</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195" x="769" y="398.0508">(server-random, agreed cipher)</text><polygon fill="#A80036" points="466,428.1035,456,432.1035,466,436.1035,462,432.1035" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="460" x2="970" y1="432.1035" y2="432.1035"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="720" y="427.3613">[8]</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="69" x="740" y="427.3613">Certificate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="813" y="427.3613">(server certificate chain)</text><polygon fill="#A80036" points="289,457.4141,279,461.4141,289,465.4141,285,461.4141" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="283" x2="454" y1="461.4141" y2="461.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="295" y="456.6719">[9]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="315" y="456.6719">retrieve certs to trust</text><polygon fill="#A80036" points="443,486.7246,453,490.7246,443,494.7246,447,490.7246" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="278" x2="449" y1="490.7246" y2="490.7246"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="285" y="485.9824">[10]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="313" y="485.9824">certificate list</text><path d="M257,503.7246 L257,528.7246 L649,528.7246 L649,513.7246 L639,503.7246 L257,503.7246 " fill="#87CEFA" filter="url(#f8yos2uopizuc)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M639,503.7246 L639,513.7246 L649,513.7246 L639,503.7246 " fill="#87CEFA" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="371" x="263" y="521.293">check certificate against chain - ie known CA or certificate</text><path d="M23,545.0352 L175,545.0352 L175,552.0352 L165,562.0352 L23,562.0352 L23,545.0352 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="203.1738" style="stroke: #000000; stroke-width: 2.0;" width="988.5" x="23" y="545.0352"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="107" x="38" y="558.6035">mutual SSL only</text><polygon fill="#A80036" points="466,579.6563,456,583.6563,466,587.6563,462,583.6563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="460" x2="970" y1="583.6563" y2="583.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="812" y="578.9141">[11]</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="124" x="840" y="578.9141">CertificateRequest</text><polygon fill="#A80036" points="466,608.9668,456,612.9668,466,616.9668,462,612.9668" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="460" x2="970" y1="612.9668" y2="612.9668"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="824" y="608.2246">[12]</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="112" x="852" y="608.2246">ServerHelloDone</text><polygon fill="#A80036" points="167,638.2773,157,642.2773,167,646.2773,163,642.2773" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="161" x2="454" y1="642.2773" y2="642.2773"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="229" y="637.5352">[13]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="257" y="637.5352">get my certificate (private key)</text><path d="M33,655.2773 L33,680.2773 L275,680.2773 L275,665.2773 L265,655.2773 L33,655.2773 " fill="#87CEFA" filter="url(#f8yos2uopizuc)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M265,655.2773 L265,665.2773 L275,665.2773 L265,655.2773 " fill="#87CEFA" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="221" x="39" y="672.8457">Looks for best matching certificate</text><polygon fill="#A80036" points="443,706.8984,453,710.8984,443,714.8984,447,710.8984" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="156" x2="449" y1="710.8984" y2="710.8984"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="163" y="706.1563">[14]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="182" x="191" y="706.1563">return certificate (public key)</text><polygon fill="#A80036" points="959,736.209,969,740.209,959,744.209,963,740.209" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="455" x2="965" y1="740.209" y2="740.209"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="462" y="735.4668">[15]</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="69" x="490" y="735.4668">Certificate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="563" y="735.4668">(client certificate chain)</text><path d="M235,760.209 L235,785.209 L671,785.209 L671,770.209 L661,760.209 L235,760.209 " fill="#87CEFA" filter="url(#f8yos2uopizuc)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M661,760.209 L661,770.209 L671,770.209 L661,760.209 " fill="#87CEFA" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="415" x="241" y="777.7773">generates a pre-master secret encrypted using server's public key</text><polygon fill="#A80036" points="959,811.8301,969,815.8301,959,819.8301,963,815.8301" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="455" x2="965" y1="815.8301" y2="815.8301"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="462" y="811.0879">[16]</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="130" x="490" y="811.0879">ClientKeyExchange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="624" y="811.0879">(premaster secret)</text><path d="M416,830.8301 L568,830.8301 L568,837.8301 L558,847.8301 L416,847.8301 L416,830.8301 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="85.9316" style="stroke: #000000; stroke-width: 2.0;" width="711" x="416" y="830.8301"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="107" x="431" y="844.3984">mutual SSL only</text><polygon fill="#A80036" points="959,865.4512,969,869.4512,959,873.4512,963,869.4512" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="455" x2="965" y1="869.4512" y2="869.4512"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="462" y="864.709">[17]</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="109" x="490" y="864.709">CertificateVerify</text><path d="M825,882.4512 L825,907.4512 L1113,907.4512 L1113,892.4512 L1103,882.4512 L825,882.4512 " fill="#87CEFA" filter="url(#f8yos2uopizuc)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1103,882.4512 L1103,892.4512 L1113,892.4512 L1103,882.4512 " fill="#87CEFA" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="267" x="831" y="900.0195">decrypts pre-master key using private key</text><path d="M717,928.7617 L717,953.7617 L1220,953.7617 L1220,938.7617 L1210,928.7617 L717,928.7617 " fill="#87CEFA" filter="url(#f8yos2uopizuc)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1210,928.7617 L1210,938.7617 L1220,938.7617 L1210,928.7617 " fill="#87CEFA" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="482" x="723" y="946.3301">creates Master secret using premaster secret, client-random, server-random</text><polygon fill="#A80036" points="959,980.3828,969,984.3828,959,988.3828,963,984.3828" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="455" x2="965" y1="984.3828" y2="984.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="462" y="979.6406">[18]</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="128" x="490" y="979.6406">ChangeCipherSpec</text><polygon fill="#A80036" points="959,1009.6934,969,1013.6934,959,1017.6934,963,1013.6934" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="455" x2="965" y1="1013.6934" y2="1013.6934"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="462" y="1008.9512">[19]</text><path d="M495.3333,999.7767 C494.1428,999.7767 493.1667,1000.7528 493.1667,1001.9434 L493.1667,1003.0267 L492.0833,1003.0267 L492.0833,1007.36 L498.5833,1007.36 L498.5833,1003.0267 L497.5,1003.0267 L497.5,1001.9434 C497.5,1000.7528 496.5239,999.7767 495.3333,999.7767 M495.3333,1000.86 C495.9411,1000.86 496.4167,1001.3356 496.4167,1001.9434 L496.4167,1003.0267 L494.25,1003.0267 L494.25,1001.9434 C494.25,1001.3356 494.7256,1000.86 495.3333,1000.86 " fill="#000000" style="stroke: ; stroke-width: 0.0; stroke-dasharray: ;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="57" x="500.6667" y="1008.9512">Finished</text><polygon fill="#A80036" points="466,1039.0039,456,1043.0039,466,1047.0039,462,1043.0039" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="460" x2="970" y1="1043.0039" y2="1043.0039"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="808" y="1038.2617">[20]</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="128" x="836" y="1038.2617">ChangeCipherSpec</text><polygon fill="#A80036" points="466,1068.3145,456,1072.3145,466,1076.3145,462,1072.3145" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="460" x2="970" y1="1072.3145" y2="1072.3145"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="868.3333" y="1067.5723">[21]</text><path d="M901.6667,1058.3978 C900.4761,1058.3978 899.5,1059.3739 899.5,1060.5645 L899.5,1061.6478 L898.4167,1061.6478 L898.4167,1065.9811 L904.9167,1065.9811 L904.9167,1061.6478 L903.8333,1061.6478 L903.8333,1060.5645 C903.8333,1059.3739 902.8572,1058.3978 901.6667,1058.3978 M901.6667,1059.4811 C902.2744,1059.4811 902.75,1059.9567 902.75,1060.5645 L902.75,1061.6478 L900.5833,1061.6478 L900.5833,1060.5645 C900.5833,1059.9567 901.0589,1059.4811 901.6667,1059.4811 " fill="#000000" style="stroke: ; stroke-width: 0.0; stroke-dasharray: ;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="57" x="907" y="1067.5723">Finished</text><path d="M416,1094.3145 L571,1094.3145 L571,1101.3145 L561,1111.3145 L416,1111.3145 L416,1094.3145 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="75.9316" style="stroke: #000000; stroke-width: 2.0;" width="595.5" x="416" y="1094.3145"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="110" x="431" y="1107.8828">Application  Use</text><polygon fill="#A80036" points="959,1128.9355,969,1132.9355,959,1136.9355,963,1132.9355" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="455" x2="965" y1="1132.9355" y2="1132.9355"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="462" y="1128.1934">[22]</text><path d="M495.3333,1119.0189 C494.1428,1119.0189 493.1667,1119.995 493.1667,1121.1855 L493.1667,1122.2689 L492.0833,1122.2689 L492.0833,1126.6022 L498.5833,1126.6022 L498.5833,1122.2689 L497.5,1122.2689 L497.5,1121.1855 C497.5,1119.995 496.5239,1119.0189 495.3333,1119.0189 M495.3333,1120.1022 C495.9411,1120.1022 496.4167,1120.5778 496.4167,1121.1855 L496.4167,1122.2689 L494.25,1122.2689 L494.25,1121.1855 C494.25,1120.5778 494.7256,1120.1022 495.3333,1120.1022 " fill="#000000" style="stroke: ; stroke-width: 0.0; stroke-dasharray: ;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="504.6667" y="1128.1934">GET /path/request</text><polygon fill="#A80036" points="466,1158.2461,456,1162.2461,466,1166.2461,462,1162.2461" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="460" x2="970" y1="1162.2461" y2="1162.2461"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="864.3333" y="1157.5039">[23]</text><path d="M897.6667,1148.3294 C896.4761,1148.3294 895.5,1149.3055 895.5,1150.4961 L895.5,1151.5794 L894.4167,1151.5794 L894.4167,1155.9128 L900.9167,1155.9128 L900.9167,1151.5794 L899.8333,1151.5794 L899.8333,1150.4961 C899.8333,1149.3055 898.8572,1148.3294 897.6667,1148.3294 M897.6667,1149.4128 C898.2744,1149.4128 898.75,1149.8883 898.75,1150.4961 L898.75,1151.5794 L896.5833,1151.5794 L896.5833,1150.4961 C896.5833,1149.8883 897.0589,1149.4128 897.6667,1149.4128 " fill="#000000" style="stroke: ; stroke-width: 0.0; stroke-dasharray: ;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="57" x="907" y="1157.5039">response</text><!--MD5=[36ac4eb3dff5da61e8e5160b86511d90]
@startuml

autonumber "[0]"


skinparam noteBackgroundColor LightSkyBlue
skinparam participant {
    backgroundColor Lavender
}

skinparam sequenceMessageAlign direction

title TLS exchange showing client/server access to truststores and keystores (2 way SSL - RFC5246)


database ClientKeyStore #lightgreen
database ClientTrustStore #lightgreen
participant Client
participant Server
database ServerTrustStore #lightgreen
database ServerKeyStore #lightgreen

group TCP handshake

    Client -> Server: **SYN**
    Server - -> Client: **SYN**, **ACK**
    Client -> Server: **ACK**
end

group TLS handshake

    Client -> Server: **ClientHello** (client-random, TLS version, ciphers, compression,extensions)
    Server -> ServerKeyStore: get my certificate (private key)
    note over ServerKeyStore: Looks for first matching server key
    ServerKeyStore -> Server: returns certificate (public key)
    Server -> Client: **ServerHello** (server-random, agreed cipher)


    Server -> Client: **Certificate** (server certificate chain)
    Client -> ClientTrustStore: retrieve certs to trust
    ClientTrustStore -> Client: certificate list
    note over Client: check certificate against chain - ie known CA or certificate

    group #oldLace mutual SSL only
        Server -> Client: **CertificateRequest**
        Server -> Client: **ServerHelloDone**

        Client -> ClientKeyStore: get my certificate (private key)
        note over ClientKeyStore: Looks for best matching certificate
        ClientKeyStore -> Client: return certificate (public key)
        Client->Server: **Certificate** (client certificate chain)
    end

    note over Client: generates a pre-master secret encrypted using server's public key
    Client -> Server: **ClientKeyExchange** (premaster secret)

    group #oldLace mutual SSL only
        Client->Server: **CertificateVerify**
        note over Server: decrypts pre-master key using private key
    end

    note over Server: creates Master secret using premaster secret, client-random, server-random
    Client -> Server: **ChangeCipherSpec**
    Client -> Server: <&lock-locked>**Finished**
    Server -> Client: **ChangeCipherSpec**
    Server -> Client: <&lock-locked>**Finished**

end

group Application  Use
   Client -> Server: <&lock-locked> GET /path/request
   Server -> Client: <&lock-locked> response
end
@enduml

PlantUML version 1.2020.14(Sat Jun 20 15:14:34 BST 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>